<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Playground ‚Äî Calendrier</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/style.css">

  <style>
    /* ===== Calendrier (joli + responsive) ===== */
    .calendar-wrap{
      width: min(1200px, calc(100% - 60px));
      margin: 26px auto 80px;
    }

    .calendar-head{
      display:flex;
      align-items:flex-end;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 14px;
    }

    .calendar-title{
      margin: 0;
      font-size: 44px;
      letter-spacing: -0.5px;
    }

    .calendar-sub{
      margin: 6px 0 0;
      opacity: .85;
      font-weight: 700;
    }

    .calendar-tools{
      display:flex;
      gap: 10px;
      align-items:center;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .calendar-input{
      border: 0;
      outline: none;
      padding: 12px 14px;
      border-radius: 999px;
      background: rgba(255,255,255,.35);
      box-shadow: 0 8px 18px rgba(0,0,0,.10);
      min-width: 240px;
      font-weight: 700;
    }

    .calendar-pill{
      padding: 10px 14px;
      border-radius: 999px;
      background: rgba(255,255,255,.30);
      box-shadow: 0 8px 18px rgba(0,0,0,.10);
      font-weight: 800;
      opacity: .9;
    }

    .day-block{
      margin-top: 16px;
      background: rgba(255,255,255,.18);
      border-radius: 18px;
      box-shadow: 0 10px 22px rgba(0,0,0,.10);
      overflow: hidden;
    }

    .day-head{
      display:flex;
      align-items:center;
      justify-content: space-between;
      padding: 14px 16px;
      background: rgba(255,255,255,.20);
      border-bottom: 1px solid rgba(255,255,255,.22);
    }

    .day-date{
      font-weight: 900;
      font-size: 18px;
    }

    .day-count{
      font-weight: 900;
      opacity: .8;
      font-size: 13px;
    }

    .games{
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      padding: 14px;
    }

    .game-card{
      background: rgba(255,255,255,.20);
      border-radius: 16px;
      padding: 12px 12px;
      box-shadow: 0 10px 22px rgba(0,0,0,.08);
      display:flex;
      flex-direction: column;
      gap: 10px;
    }

    .game-top{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 12px;
      font-weight: 900;
    }

    .game-time{
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.28);
      font-size: 13px;
      white-space: nowrap;
    }

    .matchup{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
    }

    .team{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width: 0;
      flex: 1;
    }

    .team.right{
      justify-content: flex-end;
      text-align: right;
    }

    .team img{
      width: 26px;
      height: 26px;
      object-fit: contain;
      filter: drop-shadow(0 1px 1px rgba(0,0,0,.25));
      flex: 0 0 26px;
    }

    .team-name{
      font-weight: 900;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .at{
      font-weight: 1000;
      opacity: .75;
      padding: 0 6px;
    }

    .meta{
      opacity: .85;
      font-weight: 800;
      font-size: 13px;
      line-height: 1.25;
    }

    .state{
      opacity: .8;
      font-weight: 900;
      font-size: 12px;
    }

    .empty{
      margin-top: 18px;
      padding: 18px;
      border-radius: 18px;
      background: rgba(255,255,255,.18);
      box-shadow: 0 10px 22px rgba(0,0,0,.10);
      font-weight: 900;
      opacity: .9;
    }

    @media (max-width: 980px){
      .calendar-title{ font-size: 34px; }
      .games{ grid-template-columns: 1fr; }
      .calendar-input{ min-width: 200px; }
    }
  </style>
</head>

<body>

<header class="topbar">
  <div class="top-right">
    <a href="index.html">
      <img src="logo-playground.png" alt="Playground" class="logo-img">
    </a>
  </div>

  <div class="top-left">

    <div class="banner">
      <span class="label">SCORES</span>
      <div class="marquee">
        <div class="marquee__track">
          <div class="marquee__content">
            <span class="item">
              <img class="team-logo" alt="Lakers" src="https://raw.githubusercontent.com/gtkacz/nba-logo-api/main/icons/lal.svg">
              Lakers 112‚Äì108 Suns
              <img class="team-logo" alt="Suns" src="https://raw.githubusercontent.com/gtkacz/nba-logo-api/main/icons/phx.svg">
            </span>
            <span class="dot">&nbsp;‚Ä¢&nbsp;</span>
            <span class="item">
              <img class="team-logo" alt="Celtics" src="https://raw.githubusercontent.com/gtkacz/nba-logo-api/main/icons/bos.svg">
              Celtics 120‚Äì114 Knicks
              <img class="team-logo" alt="Knicks" src="https://raw.githubusercontent.com/gtkacz/nba-logo-api/main/icons/nyk.svg">
            </span>
            <span class="dot">&nbsp;‚Ä¢&nbsp;</span>
            <span class="item">
              <img class="team-logo" alt="Bulls" src="https://raw.githubusercontent.com/gtkacz/nba-logo-api/main/icons/chi.svg">
              Bulls 104‚Äì99 Heat
              <img class="team-logo" alt="Heat" src="https://raw.githubusercontent.com/gtkacz/nba-logo-api/main/icons/mia.svg">
            </span>
            <span class="dot">&nbsp;‚Ä¢&nbsp;</span>
          </div>

          <div class="marquee__content" aria-hidden="true">
            <span class="item">
              <img class="team-logo" alt="Lakers" src="https://raw.githubusercontent.com/gtkacz/nba-logo-api/main/icons/lal.svg">
              Lakers 112‚Äì108 Suns
              <img class="team-logo" alt="Suns" src="https://raw.githubusercontent.com/gtkacz/nba-logo-api/main/icons/phx.svg">
            </span>
            <span class="dot">&nbsp;‚Ä¢&nbsp;</span>
            <span class="item">
              <img class="team-logo" alt="Celtics" src="https://raw.githubusercontent.com/gtkacz/nba-logo-api/main/icons/bos.svg">
              Celtics 120‚Äì114 Knicks
              <img class="team-logo" alt="Knicks" src="https://raw.githubusercontent.com/gtkacz/nba-logo-api/main/icons/nyk.svg">
            </span>
            <span class="dot">&nbsp;‚Ä¢&nbsp;</span>
            <span class="item">
              <img class="team-logo" alt="Bulls" src="https://raw.githubusercontent.com/gtkacz/nba-logo-api/main/icons/chi.svg">
              Bulls 104‚Äì99 Heat
              <img class="team-logo" alt="Heat" src="https://raw.githubusercontent.com/gtkacz/nba-logo-api/main/icons/mia.svg">
            </span>
            <span class="dot">&nbsp;‚Ä¢&nbsp;</span>
          </div>
        </div>
      </div>
    </div>

    <div class="banner">
      <span class="label">TRANSFERTS</span>
      <div class="marquee">
        <div class="marquee__track marquee__track--slow">
          <div class="marquee__content">
            <span class="item">
              <img class="team-logo" alt="Bucks" src="https://raw.githubusercontent.com/gtkacz/nba-logo-api/main/icons/mil.svg">
              Giannis ‚Üí Heat
              <img class="team-logo" alt="Heat" src="https://raw.githubusercontent.com/gtkacz/nba-logo-api/main/icons/mia.svg">
            </span>
            <span class="dot">&nbsp;‚Ä¢&nbsp;</span>
            <span class="item">
              <img class="team-logo" alt="Mavericks" src="https://raw.githubusercontent.com/gtkacz/nba-logo-api/main/icons/dal.svg">
              Luka Donƒçiƒá ‚Üí Lakers
              <img class="team-logo" alt="Lakers" src="https://raw.githubusercontent.com/gtkacz/nba-logo-api/main/icons/lal.svg">
            </span>
            <span class="dot">&nbsp;‚Ä¢&nbsp;</span>
          </div>

          <div class="marquee__content" aria-hidden="true">
            <span class="item">
              <img class="team-logo" alt="Bucks" src="https://raw.githubusercontent.com/gtkacz/nba-logo-api/main/icons/mil.svg">
              Giannis ‚Üí Heat
              <img class="team-logo" alt="Heat" src="https://raw.githubusercontent.com/gtkacz/nba-logo-api/main/icons/mia.svg">
            </span>
            <span class="dot">&nbsp;‚Ä¢&nbsp;</span>
            <span class="item">
              <img class="team-logo" alt="Mavericks" src="https://raw.githubusercontent.com/gtkacz/nba-logo-api/main/icons/dal.svg">
              Luka Donƒçiƒá ‚Üí Lakers
              <img class="team-logo" alt="Lakers" src="https://raw.githubusercontent.com/gtkacz/nba-logo-api/main/icons/lal.svg">
            </span>
            <span class="dot">&nbsp;‚Ä¢&nbsp;</span>
          </div>
        </div>
      </div>
    </div>

    <nav class="menu">
      <button class="search-btn" aria-label="Rechercher">üîç</button>
      <a href="actus.html">Actus</a>
      <a href="equipes.html">√âquipes</a>
      <a class="active" href="calendrier.html">Calendrier</a>
      <a href="classement.html">Classement</a>
    </nav>

  </div>
</header>

<main class="calendar-wrap">
  <div class="calendar-head">
    <div>
      <h1 class="calendar-title">Calendrier NBA</h1>
      <p class="calendar-sub">Janvier 2026 ‚Äî heures affich√©es en France (Europe/Paris)</p>
    </div>

    <div class="calendar-tools">
      <input id="teamFilter" class="calendar-input" placeholder="Filtrer par √©quipe (ex: Lakers, BOS, Knicks‚Ä¶)" />
      <span id="countPill" class="calendar-pill">Chargement‚Ä¶</span>
    </div>
  </div>

  <div id="calendarRoot"></div>
</main>

<script src="js/main.js"></script>
<script>
  // Source officielle NBA (saison 2025-26 compl√®te)
  // On filtre ensuite sur Janvier 2026.
  const SCHEDULE_URL = "https://cdn.nba.com/static/json/staticData/scheduleLeagueV2.json";

  // Mapping tricode -> code logo (nba-logo-api)
  // (Le repo utilise des codes type "lal", "bos", etc.)
  const LOGO = {
    ATL:"atl", BOS:"bos", BKN:"bkn", CHA:"cha", CHI:"chi", CLE:"cle", DAL:"dal", DEN:"den", DET:"det",
    GSW:"gsw", HOU:"hou", IND:"ind", LAC:"lac", LAL:"lal", MEM:"mem", MIA:"mia", MIL:"mil", MIN:"min",
    NOP:"nop", NYK:"nyk", OKC:"okc", ORL:"orl", PHI:"phi", PHX:"phx", POR:"por", SAC:"sac", SAS:"sas",
    TOR:"tor", UTA:"uta", WAS:"was"
  };

  const logoUrl = (tri) => {
    const code = LOGO[tri] || String(tri || "").toLowerCase();
    return `https://raw.githubusercontent.com/gtkacz/nba-logo-api/main/icons/${code}.svg`;
  };

  const fmtDateFR = (isoDate) => {
    // isoDate = "2026-01-05T00:00:00Z" etc.
    const d = new Date(isoDate);
    return new Intl.DateTimeFormat("fr-FR", {
      timeZone: "Europe/Paris",
      weekday: "long",
      day: "2-digit",
      month: "long",
      year: "numeric"
    }).format(d);
  };

  const fmtTimeFR = (isoDateTime) => {
    const d = new Date(isoDateTime);
    return new Intl.DateTimeFormat("fr-FR", {
      timeZone: "Europe/Paris",
      hour: "2-digit",
      minute: "2-digit"
    }).format(d);
  };

  function normalize(str){
    return (str || "")
      .toString()
      .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
      .toLowerCase()
      .trim();
  }

  function gameMatchesFilter(game, q){
    if(!q) return true;

    const home = `${game.homeTeam?.teamCity || ""} ${game.homeTeam?.teamName || ""} ${game.homeTeam?.teamTricode || ""}`;
    const away = `${game.awayTeam?.teamCity || ""} ${game.awayTeam?.teamName || ""} ${game.awayTeam?.teamTricode || ""}`;
    return normalize(home).includes(q) || normalize(away).includes(q);
  }

  function render(groups){
    const root = document.getElementById("calendarRoot");
    const pill = document.getElementById("countPill");

    let totalGames = 0;
    for (const g of groups) totalGames += g.games.length;
    pill.textContent = `${totalGames} matchs`;

    if(totalGames === 0){
      root.innerHTML = `<div class="empty">Aucun match trouv√© (essaie un autre filtre).</div>`;
      return;
    }

    root.innerHTML = groups.map(group => {
      const dateLabel = group.label;
      const gamesHtml = group.games.map(g => {
        const time = g.gameDateTimeUTC ? fmtTimeFR(g.gameDateTimeUTC) : "‚Äî";
        const arena = [g.arenaName, g.arenaCity].filter(Boolean).join(" ‚Ä¢ ");
        const status = g.gameStatusText || "";

        const homeTri = g.homeTeam?.teamTricode;
        const awayTri = g.awayTeam?.teamTricode;

        const homeName = `${g.homeTeam?.teamCity || ""} ${g.homeTeam?.teamName || ""}`.trim();
        const awayName = `${g.awayTeam?.teamCity || ""} ${g.awayTeam?.teamName || ""}`.trim();

        return `
          <div class="game-card">
            <div class="game-top">
              <div class="state">${status}</div>
              <div class="game-time">${time}</div>
            </div>

            <div class="matchup">
              <div class="team">
                <img src="${logoUrl(awayTri)}" alt="${awayTri || "Away"}">
                <div class="team-name">${awayName || awayTri || "‚Äî"}</div>
              </div>

              <div class="at">@</div>

              <div class="team right">
                <div class="team-name">${homeName || homeTri || "‚Äî"}</div>
                <img src="${logoUrl(homeTri)}" alt="${homeTri || "Home"}">
              </div>
            </div>

            <div class="meta">${arena || ""}</div>
          </div>
        `;
      }).join("");

      return `
        <section class="day-block">
          <div class="day-head">
            <div class="day-date">${dateLabel}</div>
            <div class="day-count">${group.games.length} match${group.games.length > 1 ? "s" : ""}</div>
          </div>
          <div class="games">${gamesHtml}</div>
        </section>
      `;
    }).join("");
  }

  async function loadAndRender(){
    const root = document.getElementById("calendarRoot");
    const pill = document.getElementById("countPill");
    const input = document.getElementById("teamFilter");

    root.innerHTML = "";
    pill.textContent = "Chargement‚Ä¶";

    let data;
    try{
      const res = await fetch(SCHEDULE_URL, { cache: "no-store" });
      data = await res.json();
    }catch(e){
      root.innerHTML = `<div class="empty">Impossible de charger le calendrier NBA (r√©seau/CORS). R√©essaie dans 1 minute.</div>`;
      pill.textContent = "Erreur";
      return;
    }

    // Le JSON contient gameDates[] avec des games[] pour chaque date.
    const gameDates = data?.leagueSchedule?.gameDates || [];

    // On garde uniquement Janvier 2026 (heure UTC dans gameDateEst)
    const janGamesByDate = [];

    for(const gd of gameDates){
      const games = gd?.games || [];
      if(!games.length) continue;

      // gameDateEst: "2026-01-05T00:00:00Z" etc.
      const dateEst = games[0]?.gameDateEst || gd?.gameDateEst;
      if(!dateEst) continue;

      const d = new Date(dateEst);
      const year = d.getUTCFullYear();
      const month = d.getUTCMonth() + 1; // 1..12

      if(year === 2026 && month === 1){
        janGamesByDate.push({
          dateISO: dateEst,
          games
        });
      }
    }

    // tri par date
    janGamesByDate.sort((a,b) => new Date(a.dateISO) - new Date(b.dateISO));

    function buildGroups(filterValue){
      const q = normalize(filterValue);
      return janGamesByDate
        .map(day => {
          const filtered = day.games.filter(g => gameMatchesFilter(g, q));
          return {
            label: fmtDateFR(day.dateISO),
            dateISO: day.dateISO,
            games: filtered
          };
        })
        .filter(day => day.games.length > 0);
    }

    // rendu initial
    render(buildGroups(""));

    // filtre live
    let t = null;
    input.addEventListener("input", () => {
      clearTimeout(t);
      t = setTimeout(() => {
        render(buildGroups(input.value));
      }, 120);
    });
  }

  loadAndRender();
</script>
</body>
</html>
